<section class="page-form-ele page ng-scope">
    <div class="panel panel-default">
        <div class="panel-heading"><strong>API Documentation</strong></div>
        <div class="panel-body">
            <div class="row col-sm-10 col-sm-offset-1">
                <h1>Backand Basics</h1>
                <h2>What is Backand</h2>
                <p>
                    Backand's goal is to anable developers to concentrate in the client UI while maintaining rich and robust scalable backend that does not set back any client development.
                    The key element in Backand is the <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> but most application's backend requires more than that.
                    Backand provides you with most of what you automatically, such as tracking changes of the data, logging, role-based security, back-office and more. If you still need more,
                    You can create your own server side action with javascript, create server side queries and easily integrate with 3rd parties services.
                </p>
                <h2>Backand ORM</h2>
                <p>
                    Backand <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> automatically provides you with a REST API to perform <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations with your database.
                    You can connect an existing database you already have or create a new database at Backand. When you create a database at Backand you create it at <a href="http://aws.amazon.com/rds/">AWS RDS</a> which is an indepndent issolated database that you can scale or use indepndently from Backand.
                    although Backand is a software service and not a platform service, it is truly <b>your</b> database.
                </p>
                <h3>
                    Model Definition
                </h3>
                <p></p>
                <h3>
                    Enjoy both worlds of SQL and NoSQL
                </h3>
                <p>
                    There are two ways to perform <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations. One way is to perform a shellow request. This way you read or write objects without relation to collection of child objects. This is similar to working with SQL database.
                    Another way is to perform requests with deep objects, this will read and write objects with their child collection, similar to working with NoSQL databases.
                </p>
                <h2>Security Concept</h2>
                <h3>Authentication</h3>
                <p></p>
                <h3>Annonymous Access</h3>
                <p></p>
                <h3>Public vs. Private App</h3>
                <p></p>
                <h3>Roles</h3>
                <p></p>
                <h2>Custom Actions</h2>
                <p></p>
                <h2>Queries</h2>
                <p></p>
                <!--<h2>Back Office</h2>-->
                <h2>
                    API Description
                </h2>

                <h3>
                    Security & Authentication
                </h3>

            <p>
                Backand provides a role based security, that enables you to determine specific permissions for each group of users.
                To identify the user, Backand uses OAuth2 authentication.
                With Backand implementation of OAuth2 authentication you need first to send the username, password and appname (application name) and receive an authentication token that is used for all further communication with Backand.<br/>
                By using a cookie to persist the authentication token you will be able to access and use Backand's REST API. 
                We prepared a Backand Provider that will help you the authentication activities. Please add the Backand script files to your app:
            </p>
                <pre><code class="html hljs">
      &lt;!-- We use client cookies to save the REST API token --&gt;
      &lt;script src="//code.angularjs.org/1.3.0/angular-cookies.min.js"&gt;&lt;/script&gt;
      &lt;!-- Backand SDK for Angular --&gt;
      &lt;script src="//cdn.backand.net/backand/dist/1.5.1/backand.min.js"&gt;&lt;/script&gt;
    </code></pre>
                <p>
                    You will also need to add the backand and angular-cookies dependencies to your angular app definition
                </p>
                <pre><code class="javascript">
      //app.js
      angular.module('YOUR-APP-NAME', ['backand', 'ngCookies'])
    </code></pre>
                <p>Now you are ready to sign in to Backand, for other users to sign up to your app read about it <a ng-href="\#/docs/api#sign_up">here</a> There is also an option for anonymous access, read about it here</p>
                <br />
                <h4 id="sign_in">
                    Sign In
                </h4>
                <br />
                <p>Use the Backand provider with the following parameters to get an AOuth2 access token:</p>

                <ul class="task-list">
                    <li><p><strong>username</strong> - Backand's username.</p></li>
                    <li><p><strong>password</strong> - Backand's .password</p></li>
                    <li><p><strong>appName</strong> - The application name.</p></li>
                </ul>


                <pre><code>
      // SignInCtrl.js
      function SignInCtrl(Backand, $cookieStore) {
        $scope.signIn = function() {
          Backand.signin($scope.username, $scope.password, $scope.appName)
          .then(
            function (token) {
              //save the token in the cookie
              $cookieStore.put(Backand.configuration.tokenName, token);
            },
            function (data, status, headers, config) {
              //handle error
            }
          );
        }
      }

      // Use an Angular HTTP Interceptor to add the authentication token to each HTTP request
      function httpInterceptor($q, $log, $cookieStore) {
        return {
          request: function(config) {
            config.headers['Authorization'] = $cookieStore.get('backand_token');
            return config;
          }
        };
      }
    </code></pre>
                <br />
        <h4 id="sign_up">
            Sign Up
        </h4>
                <p>
                    With the <code>/user/signup</code> api you can enable other users to sign up to your app. 
                    The sign up process is consisted of the following steps:
                    <ul style="list-style-type:decimal">
                        <li>
                            From your app's registration page, call the
                            <code>/user/signup</code> action
                        </li>
                        <li>
                            This will automatically send an invitation email to the user for verification purposes
                        </li>
                        <li>
                            The email has a link that when the user clicks on it, Backand verifies his email address and complete the sign up process by redirecting to a page that you defined for this process, usually your app sign in page.
                        </li>
                    </ul>
                    The sign up api uses a SignUpToken in the request header. You can find this token in the Security & Auth Configuration menu
                    <br />
                    (*) Configuration of the sign up process is located in the App left side menu: Security & Auth --> Configuration
                </p>
        <br />
        <ul class="task-list">
            <li><p><strong>SignUpToken</strong> - A security token to prevent malicious attacks. this should be added to the header</p></li>
            <li><p><strong>user</strong> - The user first and last name, email and password.</p></li>
        </ul>
                <pre>
{
  "firstName": "string",
  "lastName": "string",
  "email": "string",
  "password": "string",
  "confirmPassword": "string"
}
</pre>

<pre>
  self.signUp = function (user, signUpToken) {
      return $http({
          method: 'POST',
          url : Backand.configuration.apiUrl + '/1/user/signup,
          headers: {
            'SignUpToken': signUpToken
          },
          data: user
      })
  };
</pre>
        

                <h4 id="anonymous_access">
                    Anonymous Access
                </h4>
                <p>
                    If you want to allow anonymous users to access the application, without username and password, you can use the AnonymousToken
                </p>
                <pre><code>
      
      // Use an Angular HTTP Interceptor to add the anonymous token to each HTTP request
      function httpInterceptor($q, $log) {
        return {
          request: function(config) {
            config.headers['AnonymousToken'] = anonymousToken;
            return config;
          }
        };
      }
    </code></pre>
                <br />

        <h3>
            REST API CRUD Operations
        </h3>
            <p>With the authentication configurations settled you can perform all the CRUD operations:</p>
            <br/>
            <h4>
                List of Objects
            </h4>
            <br/>
            <p>Call <code>/object/{name}</code> with the following parameters to get a list of items:</p>

            <ul class="task-list">
                <li><p><strong>pageSize</strong> - The number of returned items in each getList call, default 20.</p></li>
                <li><p><strong>pageNumber</strong> - The page number starting with 1, default 1.</p></li>
                <li><p><strong>filter</strong> - An array where each item has the properties fieldName, operator and value. The operator options depend on the field type.</p></li>
                <li><p><strong>sort</strong> - An array where each item has the properties fieldName and order. The order options are "asc" or "desc".</p></li>
                <li><p><strong>search</strong> - Free text filter search.</p></li>
                <li><p><strong>deep</strong> - When set to true, brings the related parent items in the relatedTables property.</p></li>
                <!--<li><p></p><strong>withSelectOptions</strong> - When set to true, get a text value collection to load select options according to parent relations.</li>-->
            </ul>


<pre>
  self.getList = function (name, pageSize, pageNumber, filter, sort) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/object/' + name,
          params: {
            pageSize: pageSize,
            pageNumber: pageNumber,
            sort: sort,
            filter: filter
          }
      });
  };
</pre>
            <br/>
            <h4>
                One Object
            </h4>
            <br/>
            <p>Call <code>/object/{name}/{id}</code> with a specific item id and with the following parameters to get a specific item:</p>

            <ul class="task-list">
                <li><p><strong>id</strong> - The item id which is the primary kay value of a table row </p></li>
                <li><p><strong>deep</strong> - When set to true, brings the related objects</p></li>
            </ul>

<pre>
  self.getOne = function (name, id, deep) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/object/' + name + '/' + id
          params: {
            deep: deep
          }
      });
  };
</pre>
            <br/>
            <h4>
                Create
            </h4>
            <br/>
            <p>Call <code>/object/{name}</code> POST with a new object to create, with the following parameters:</p>

            <ul class="task-list">
                <li>
                    <strong>returnObject</strong> - Set this to true when you have server side business rules that causes additional changes to the object. In that case this request will return the created object
                </li>
            </ul>

<pre>
  self.create = function (name, data, returnObject) {
      return $http({
          method: 'POST',
          url : Backand.configuration.apiUrl + '/1/object/' + name,
          data: data,
          params: {
            returnObject: returnObject
          }
      })
  };
</pre>
            <br/>
            <h4>
                Update
            </h4>
            <br/>
            <p>Call <code>/object/{name}/{id}</code> PUT to update an existing object with the following parameters:</p>

            <ul class="task-list">
                <li>
                    <strong>id</strong> - The item id which is the primary kay value of a table row
                    <strong>returnObject</strong> - Set this to true when you have server side business rules, causing additional changes to the object. In this case the request will return the created object
                </li>
            </ul>

<pre>
  self.update = function (name, id, data, returnObject) {
      return $http({
          method: 'PUT',
          url : Backand.configuration.apiUrl + '/1/object/' + name + '/' + id,
          data: data,
          params: {
            returnObject: returnObject
          }
      })
  };
</pre>
            <br/>
            <h4>
                Delete
            </h4>
            <br/>
            <p>Call <code>/object/{name}/{id}</code> DELETE to remove an item:</p>
              <ul class="task-list">
                <li>
                  <strong>id</strong> - The item id which is the primary kay value of a table row
                </li>
              </ul>
<pre>
  self.delete = function (name, id) {
      return $http({
          method: 'DELETE',
          url : Backand.configuration.apiUrl + '/1/object/' + name + '/' + id
      })
  };
</pre>
        <h3>
            Custom Actions
        </h3>
        <p>
            You can add your own custom actions and call them like this <code>/object/action/{objectName}/{id}</code> The custom action is associated with an object list, to ease security configuration. 
            It can also be associated with a specific id of an object to be used as an input to the action but it is optional. You can also define additional parameters to the action. The action return a custom json.
        </p>
        <ul class="task-list">
            <li><p><strong>actionName</strong> - The action name.</p></li>
            <li><p><strong>parameters</strong> - json object with all predefined action's parameters.</p></li>
        </ul>
                <pre>
self.callAction = function (objectName, id, actionName, parameters) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/object/action/' + objectName + '/' + id
          params: {
             parameters: parameters
          }
      });
  };
</pre>
                (*) You can find the configuration and testing environment of the custom actions in the App right side menu: each Object's Actions tab
                <br />
            <h3>
                Queries
            </h3>
                <p>
                    You can create your own queries and call them like this <code>/query/data/{queryName}</code> You write the query in the SQL syntex of the database you are using.
                    You can create predefine parameters and use them in the query
                </p>
                <ul class="task-list">
                    <li><p><strong>parameters</strong> - json object with all predefined query's parameters.</p></li>
                </ul>
                <pre>
self.query = function (queryName, parameters) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/query/data/' + queryName
          params: {
             parameters: parameters
          }
      });
  };
</pre>
                (*) You can find the configuration and testing environment of the queries in the App right side menu: Queries

                <br />
          <h3>Experience more</h3>
          <p>Review on <a href="https://github.com/backand/angular-yeoman-todos" target="_blank">github</a> our Angular demo application</p>
            </div>
        </div>
</div>
</section>
