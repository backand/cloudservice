<!--<div ng-if="!rule">-->
  <!--<p>Here you can define actions that will run on triggers (hooks).</p>-->
<!--</div>-->
<div ng-if="rules.action">
<div class="header row">
  <div class="col-xs-6">
  <h3 class="title">{{modal.title}} - {{rules.action.name}}</h3>
    </div>
  <div class="col-xs-6">

  <button ng-show="rules.allowEditAction()"
          ng-click="rules.editAction()"
          class="btn btn-success pull-right with-margin">
    edit action
  </button>

  <button ng-show="rules.editMode" ng-click="rules.saveAction()" ng-disabled="newRuleForm.$invalid" class="btn btn-primary pull-right with-margin">Save</button>
  <button ng-show="rules.action.__metadata && rules.editMode" ng-click="rules.deleteAction()" class="btn btn-danger pull-right with-margin">Delete</button>
  <button ng-show="rules.editMode" ng-click="rules.cancelEdit()" class="btn btn-default pull-right with-margin">Cancel</button>
  </div>
  <br/>
  <div class="col-xs-12">
  <button name="testCode"
          ng-show="rules.allowTestForm()"
          class="pull-right btn btn-success btn-xs with-margin"
          ng-click="rules.toggleTestForm()">
    {{ rules.showTestForm ? 'Hide Test >>' : 'Test Action >>'}}
  </button>
    </div>
</div>

<div class="clearfix">

  <form name="rules.newRuleForm" insert-at-caret novalidate>
    <fieldset ng-disabled="!rules.editMode">

    <div class="form-group col-lg-12 col-md-12 col-sm-12"
         ng-class="{ 'has-error': rules.newRuleForm.eventTrigger.$invalid && rules.newRuleForm.eventTrigger.$dirty}">
      <label>Event Trigger</label>
      <select class="form-control"
              ng-options="dataAction.value as dataAction.label for dataAction in modal.dataActions"
              ng-model="rules.action.dataAction"
              ng-model-options="{debounce:{default:100}}">
        <option value="">Select trigger...</option>
      </select>
    </div>

    <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-show="rules.action.dataAction">
      <label>Input Parameters</label>
      <input type="text"
             ng-blur="modal.buildParameters()"
             name="inputParameters"
             class="form-control"
             ng-model="rules.action.inputParameters"
             ng-model-options="{debounce:{default:100}}"
             ng-pattern**="/^[a-zA-Z0-9 ]*$/"
             placeholder="input1,input2,....">
      <span ng-show="">{{rules.action.inputParameters.$error.pattern}} Not a valid value!</span>
    </div>

    <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-show="rules.action.dataAction" ng-class="{ 'has-error': rules.newRuleForm.whereCondition.$invalid && rules.newRuleForm.whereCondition.$dirty }">
      <label>Where Condition</label>
      <div class="pull-right" ng-show="rules.editMode">
        <span class="ti-anchor" style="cursor: pointer;font-size:20px;" ng-click="modal.toggleGroup('dictionaryState')"></span>
      </div>
      <div ng-cloak>
        <angled-window ng-if="modal.isCurGroup('dictionaryState')"
                       id="{{winId}}"
                       title="Where Condition"
                       grouping="w"
                       close-function="modal.toggleGroup('dictionaryState')"
                       style="z-index: 10; right: 0; bottom: -50px;">
          <div ng-include="'views/tables/rules/where_condition_window.html'"></div>
        </angled-window>
      </div>
      <div  ui-ace="{onLoad : ace.onLoad, theme:'dawn', mode: ace.dbType}"
            id="whereCondition"
            required
            name="whereCondition"
            class="form-control ace-action-where"
            placeholder=""
            ng-model="rules.action.whereCondition"
            ng-model-options="{debounce:{default:100}}"
          style="resize: vertical">
      </div>
      <span ng-show="rules.editMode">** Enter 'true' to ensure the action always executes, or use the anchor icon to build a condition governing the execution</span>
    </div>

    <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-show="rules.action.dataAction"
         ng-class="{ 'has-error': rules.newRuleForm.action.$invalid &&  rules.newRuleForm.action.$dirty }">

      <label>Type</label>
      <select class="form-control"
              name="action"
              required
              ng-options="workflowAction.value as workflowAction.label for workflowAction in modal.workflowActions"
              ng-model="rules.action.workflowAction">
        <option value="">Select what to do...</option>
      </select>
    </div>
    <!--<div class="form-group col-sm-12">-->
      <!--<button name="testCode"-->
              <!--ng-if="rules.action.dataAction == 'OnDemand'"-->
              <!--class="pull-right btn btn-success btn-xs"-->
              <!--ng-click="modal.toggleTestCode()">-->
        <!--Test Action >>-->
      <!--</button>-->
    <!--</div>-->

    <div ng-switch="rules.action.workflowAction">

      <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-show="rules.action.workflowAction">

      <!-- notify options -->
      <div ng-switch-when="Notify">

        <div class="form-group col-lg-6 col-md-6 col-sm-6" ng-class="{ 'has-error': rules.newRuleForm.to.$invalid }">
          <label>To:</label>
          <input type="text"
                 required
                 name="to"
                 id="to"
                 ng-model="rules.action.to"
                 class="form-control"/>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Cc:</label>
          <input type="text"
                 id="cc"
                 ng-model="rules.action.cc"
                 class="form-control"/>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label for="bcc">Bcc:</label>
          <input type="text"
                 id="bcc"
                 ng-model="rules.action.bcc"
                 class="form-control"/>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label for="from">From:</label>
          <input type="text"
                 id="from"
                 ng-model="rules.action.from"
                 class="form-control"/>
        </div>

        <div ng-cloak>
          <angled-window ng-if="modal.isCurGroup('notifySubject')"
                         id="{{winId}}"
                         title="Email Subject"
                         grouping="w"
                         close-function="modal.toggleGroup('notifySubject')"
                         style="z-index: 10; right: 0; bottom: -50px;">
            <div ng-include="'views/tables/rules/send_email_subject_window.html'"></div>
          </angled-window>
        </div>
        <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-class="{ 'has-error': rules.newRuleForm.subject.$invalid }">
          <div class="pull-right" ng-show="rules.editMode">
            <span class="ti-anchor" style="cursor: pointer;font-size:20px;"
                  ng-click="modal.toggleGroup('notifySubject')"></span>
          </div>
          <label>Subject:</label>
          <input type="text"
                 required
                 name="subject"
                 id="subject"
                 ng-model="rules.action.subject"
                 class="form-control"/>
        </div>

        <div ng-cloak>
          <angled-window ng-if="modal.isCurGroup('notifyMessage')"
                         id="{{winId}}"
                         title="Email Message"
                         grouping="w"
                         close-function="modal.toggleGroup('notifyMessage')"
                         style="z-index: 10; right: 0; bottom: -50px;">
            <div ng-include="'views/tables/rules/send_email_message_window.html'"></div>
          </angled-window>
        </div>

        <div class="form-group col-lg-12 col-md-12 col-sm-12"
             ng-class="{ 'has-error': rules.newRuleForm.notifyMessage.$invalid }">

          <div class="pull-right" ng-show="rules.editMode">
            <span class="ti-anchor" style="cursor: pointer;font-size:20px;"
                  ng-click="modal.toggleGroup('notifyMessage')"></span>

          </div>
          <label for="notifyMessage">Message:</label>
          <textarea class="form-control" name="notifyMessage"
                    id="notifyMessage"
                    ng-model="rules.action.notifyMessage"
                    style="resize: vertical" rows="10"
                    on-update="modal.digest()"
                    required
            ></textarea>
        </div>

      </div>
      <!--./notify -->

      <div ng-switch-when="Validate">

        <div class="form-group col-lg-6 col-md-6 col-sm-6"
             ng-class="{ 'has-error': rules.newRuleForm.validateExp1.$invalid }">
          <label>Expression:</label>
          <textarea class="form-control"
                    required
                    name="validateExp1"
                    ng-model="rules.action.validateCommand1"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Validation Failed Message:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateMessage1"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Expression:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateCommand2"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Validation Failed Message:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateMessage2"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Expression:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateCommand3"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Validation Failed Message:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateMessage3"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Expression:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateCommand4"
                    style="resize: vertical"></textarea>
        </div>

        <div class="form-group col-lg-6 col-md-6 col-sm-6">
          <label>Validation Failed Message:</label>
          <textarea class="form-control"
                    ng-model="rules.action.validateMessage4"
                    style="resize: vertical"></textarea>
        </div>

      </div>
      <!--./validate-->

      <div ng-switch-when="Execute">

        <div ng-cloak>
          <angled-window ng-if="modal.isCurGroup('sqlCommand')"
                         id="{{winId}}"
                         title="SQL Command"
                         grouping="w"
                         close-function="modal.toggleGroup('sqlCommand')"
                         style="z-index: 10; right: 0; bottom: -50px;">
            <div ng-include="'views/tables/rules/sql_command_window.html'"></div>
          </angled-window>
        </div>
        <div class="form-group col-lg-12 col-md-12 col-sm-12"
             ng-class="{ 'has-error': rules.newRuleForm.sqlCommand.$invalid}">
          <div class="pull-right" ng-show="rules.editMode">
            <span class="ti-anchor" style="cursor: pointer;font-size:20px;"
                  ng-click="modal.toggleGroup('sqlCommand')"></span>
          </div>
          <label>Command:</label>
          <div
            ui-ace="{onLoad : ace.onLoad, theme:'dawn', mode: ace.dbType}"
            class="form-control"
            name="sqlCommand"
            id="sqlCommand"
            ng-model="rules.action.command"
            required
            style="resize: vertical">
          </div>
        </div>

        <div class="form-group col-lg-12 col-md-12 col-sm-12"
             ng-class="{ 'has-error': rules.newRuleForm.sqlMessage.$invalid}">
          <label>Message:</label>
          <textarea class="form-control"
                    ng-model="rules.action.executeMessage"
                    name="sqlMessage"
                    required
                    style="resize: vertical"></textarea>
        </div>

      </div>
<!--WebService-->
      <div ng-cloak>
        <angled-window ng-if="modal.isCurGroup('webService')"
                       id="{{winId}}"
                       title="Web Service URL"
                       grouping="w"
                       close-function="modal.toggleGroup('webService')"
                       style="z-index: 10; right: 0; bottom: -50px;">
          <div ng-include="'views/tables/rules/web_service_url_window.html'"></div>
        </angled-window>
      </div>
      <div ng-switch-when="WebService">

        <div class="form-group col-lg-12 col-md-12 col-sm-12"
             ng-class="{ 'has-error': rules.newRuleForm.webService.$invalid }">
          <div class="pull-right" ng-show="rules.editMode">
            <span class="ti-anchor" style="cursor: pointer;font-size:20px;"
                  ng-click="modal.toggleGroup('webService')"></span>
          </div>
          <label>Web Service URL:</label>
          <textarea class="form-control"
                    name="webService"
                    id="webService"
                    ng-model="rules.action.webServiceUrl"
                    required
                    style="resize: vertical"></textarea>
        </div>


      </div>
        <!--code-->
      <div ng-switch-when="JavaScript">

        <div ng-class="{ 'has-error': rules.newRuleForm.code.$invalid }">

          <div class="form-group ">
            <label>JavaScript Code:</label>
            <div  ui-ace="{onLoad : ace.onLoad, theme:'monokai', mode: 'javascript', firstLineNumber: 7}"
                  class="form-control ace-rule"
                  name="code"
                  id="code"
                  ng-model="rules.action.code"
                  required
                  ng-pattern="codeRegex"
                  ng-keydown = "modal.handleTabKey($event)"
                  style="resize: vertical; "
                  ></div>
            <div ng-messages="rules.newRuleForm.code.$error">
              <div ng-message="pattern" class="text-danger">Code is not ok!</div>
            </div>
          </div>
        </div>
      </div>
    <!-- end switch -->
    </div>
    <div class="form-group col-lg-12 col-md-12 col-sm-12" ng-show="rules.action.workflowAction"
         ng-class="{ 'has-error': rules.newRuleForm.ruleName.$invalid &&  rules.newRuleForm.ruleName.$dirty}">

      <label for="ruleName">Action Name</label>
      <input type="text"
             id="ruleName"
             name="ruleName"
             class="form-control"
             ng-model="rules.action.name"
             ng-model-options="{debounce:{default:100}}"
             required
             ng-pattern="modal.namePattern"
             placeholder="name your action">
      <div ng-show="rules.newRuleForm.ruleName.$error.pattern" class="input-error">no spaces or %$#@^&* allowed</div>

    </div>

    <div class="modal-footer" ng-show="rules.action && rules.editMode">
      <button class="btn btn-primary" ng-disabled="rules.newRuleForm.$invalid" ng-click="rules.saveAction()">Save</button>
      <button class="btn btn-danger pull-left" ng-click="rules.deleteAction()" ng-if="rules.action.__metadata">Delete</button>
      <button class="btn btn-default" ng-click="rules.cancelEdit()">Cancel</button>
    </div>
  </div>
    </fieldset>
  </form>

  <!--<div ng-cloak>-->
    <!--<angled-window ng-if="allowTestModal()"-->
                   <!--id="testCode"-->
                   <!--title="Test Code"-->
                   <!--grouping="w"-->
                   <!--close-function="modal.toggleTestCode()"-->
                   <!--style="z-index: 10; right: 0; top: 500px;">-->
      <!--<div ng-include="'views/tables/rules/test_code_window.html'"></div>-->
    <!--</angled-window>-->
  <!--</div>-->

</div>
</div>
