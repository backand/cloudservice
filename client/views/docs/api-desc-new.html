<section class="page-form-ele page ng-scope">
    <div class="panel panel-default">
        <div class="panel-heading"><strong>API Documentation</strong></div>
        <div class="panel-body">
            <div class="row col-sm-10 col-sm-offset-1">
                <h1>Backand Basics</h1>
                <h2>What is Backand</h2>
                <p>
                    Backand's goal is to anable developers to concentrate in the client UI while maintaining rich and robust scalable backend that does not set back any client development.
                    The key element in Backand is the <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> but most application's backend requires more than that.
                    Backand provides you with most of what you automatically, such as tracking changes of the data, logging, role-based security, back-office and more. If you still need more,
                    You can create your own server side action with javascript, create server side queries and easily integrate with 3rd parties services.
                </p>
                <h2>Backand ORM</h2>
                <p>
                    Backand <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> automatically provides you with a REST API to perform <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations with your database.
                    You can connect an existing database you already have or create a new database at Backand. When you create a database at Backand you create it at <a href="http://aws.amazon.com/rds/">AWS RDS</a> which is an indepndent issolated database that you can scale or use indepndently from Backand.
                    although Backand is a software service and not a platform service, it is truly <b>your</b> database.
                </p>
                <!--<h3>
                    Model Definition
                </h3>
                <p></p>-->
                <h3>
                    Enjoy both worlds of SQL and NoSQL
                </h3>
                <p>
                    There are two ways to perform <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations. One way is to perform a shellow request. This way you read or write objects without relation to collection of child objects. This is similar to working with SQL database.
                    Another way is to perform requests with deep objects, this will read and write objects with their child collection, similar to working with NoSQL databases.
                </p>
                <h2>Security Concept</h2>
                <h3>Authentication</h3>
                <p>
                    By default, you need to sign in with an email which acts as the user username, password and appname to get an authentication token so you can work with Backand. The authentication token lasts 24 hours, before you need to request it again. This sign in process implements OAuth2. We recommend that you use Bachand's angular infrastructure to help you save the access token using the <a href="https://docs.angularjs.org/api/ngCookies">ngCookies</a> and sets the default request header with the access token. 
                    To enable access to users without username and password see <a ng-href="\#/api#anonymous">Anonymous Access</a> 
                </p>
                <h3>Sign Up</h3>
                <p>
                    By registrering to Backand and creating an app you automically registered to your app with an "Admin" role (see <a ng-href="\#/api#roles">Roles</a>). Enabling other users to sign up to your app requires few steps, but first you should know that by default your app is private which means that only invited users can sign up to your app, to change that and to enable any user to register switch on the Public App option under the Security & Auth --> Configuration menu.
                    Also you need to set there as well the default role (see <a ng-href="\#/api#roles">Roles</a>) of a new registered user. You cannot set a user role through the api because of security reasons, only admin can do that through the Security & Auth --> Users page, or through server side actions. For private app the registration steps are as follow:
                    <ul>
                        <li>First you need to set your app registration page in the Security & Auth --> Configuration page. This is required for the next step</li>
                        <li>In the Security & Auth --> Users page You entered the emails of the users that you want to invite and then you click on the Invite User(s) button. The users you invite will get an email with a link to the registration page you entered in the previous step.</li>
                        <b>The following steps are the same for both Public and Private apps:</b>
                        <li>The user enters his/her email, name and password in your registration page</li>
                        <li>After the user submits the email and password Backand sends a verfication email to authenticate the user identity</li>
                        <li>After the user clicks on the link in the verification email Backand completes the registration process and redirect to the Custom Verified Email Page URL that you must enter in the Security & Auth --> Configuration page</li>
                    </ul>
                    <a ng-href="\#/api#api-sign-up">Here</a> is the api of the Sign Up
                </p>
                <h3>Remove user from the app</h3>
                <p>You cannot delete a user from the app because of all kind of references to that user. But you pause the user activity in the system by uncheck the Approved column of the user in the Security & Auth --> Users page. In anytime you can resume the user activity by checking the approve column.</p>
                <h3 id="anonymous">Anonymous Access</h3>
                <p>
                    Getting access to users without username and password does not require an access token, instead you simply add the AnonymousToken in each of the requests header: AnonymousToken=b76ff5d2-1d6f-48a1-891d-3ab04e57dbc5. To get the AnonymousToken you need to switch on the Anonymous Access option, then you can set the default role (see <a ng-href="\#/api#roles">Roles</a>) of an anonymous user and the AnonymousToken. 
                </p>
                <h3>Link your app's users with Backand's users</h3>
                <p>
                    We recommend that you create another table for your app's users with an unique email address column, this way you can build rules specific to your app but still link to Backand's users
                </p>
                <h3 id="roles">Roles & Secutity Templates</h3>
                <p>

                </p>
                <h2>Custom Actions</h2>
                For the purpose of security, integration, performance, notification and data integrity you can perform server side activities called Actions. There are two ways to initiate actions either through a direct request which is called "On Demand" or based upon a data writing event which is a create, update or delete an item. The action is associated with a specific Object which is compatible to a spesific table so you can find the Action definition in Object --> {name} page in the Actions tab.
                The Create, Update and Delete actions are also associated with a pecific item which is compatible the a specific row on that table. For an On Demand action, assocition to a row is optional. <br>there are 3 types of actions: 
                <ul>
                    <li>Server side javascript code</li>
                    <li>Transactional database script</li>
                    <li>Send Email</li>
                </ul>
                All 3 types of actions use specific and the following common parameters:<<br />
                Where Condition which is a SQL wehre statement that determine if the action will be performed.<br />
                Input Parameters, that you can add the querystring of to the CRUD request the will trigger the action or to the On Demand action parameters. These parameters will serve as tokens in the action definition and later will be replaced with the actual values.
                <h4>Server Side Javascript code</h4>
                <p>
                    You can run a vanila javascript on the server. It runs on a <a href="http://en.wikipedia.org/wiki/V8_(JavaScript_engine)">V8 engine</a>. Your code is placed inside the following function:
<pre><code class="html hljs">
function backandCallback(userInput, dbRow, parameters, userProfile) {
    // write your code here
    return {};
}
</code></pre>
                    The function parameters are:
                    <ul>
                        <li>
                            <b>userInput:</b> only exists in Create and Update actions, it is the object you sent to the action. It is null in Delete and in On Demand  
                        </li>
                        <li>
                            <b>dbRow:</b> exists in After Create, Update and Delete actions and only if you send an optional id to the On Demand action. The dbRow contains the current data on the database before it was changed.
                        </li>
                        <li>
                            <b>parameters:</b> The parameters is the object you send in the querystring of the Create, Update, Delete and On Demand actions.
                        </li>
                        <li>
                            <b>userProfile:</b> {"username": "string", "role": "string", "token": "string"}. token is the access token of the current user that made the action. 
                        </li>
                    </ul>

                    You can also use the following global objects:
                    $http - service for AJAX calls - $http({method:"GET",url:CONSTS.apiUrl + "/1/table/data/tableexample" , headers: {"Authorization":userProfile.token}});
                    CONSTS - CONSTS.apiUrl for Backands API URL

                    You can use the <code>console.log(message, object)</code> and the <code>console.error(message, object)</code> to debug your code.<br />

    If you are using this type of action in an On Demand action the response of the action will be what you return in the function, this can be any json object.
</p>
                <h4>Transactional database script</h4>
                <p>
                    When you run this code in Create, Update and Delete actions in the event "During the data saved before it committed", it tun inside the action transaction. This means that if the Create, Update or Delete fails then your script will be roled back.
                </p>
                <h4>Send Email</h4>
                <p>
                    In addition to the common parameters, you can provide the usual email parameters: To, Cc, Bcc, From, Subject and message.
                    You can use the parameters you sent in addition to a deep object based on id you sent in the action.
                </p>
                <h2>Queries</h2>
                <p>
                    You can create and call your own custom queries. You can use parameters as tokens that will be replaced with actual parameters similar to how the Custom Actions work.
                    You can create your own filter, sort and paging and use aggregation to summerize information. 
                </p>
                <!--<h2>Back Office</h2>-->
                <h2>
                    API Description
                </h2>

                <h3>
                    Security & Authentication
                </h3>

            <p>
                Backand provides a role based security, that enables you to determine specific permissions for each group of users.
                To identify the user, Backand uses OAuth2 authentication.
                With Backand implementation of OAuth2 authentication you need first to send the username, password and appname (application name) and receive an authentication token that is used for all further communication with Backand.<br/>
                By using a cookie to persist the authentication token you will be able to access and use Backand's REST API. 
                We prepared a Backand Provider that will help you the authentication activities. Please add the Backand script files to your app:
            </p>
                <pre><code class="html hljs">
      &lt;!-- We use client cookies to save the REST API token --&gt;
      &lt;script src="//code.angularjs.org/1.3.0/angular-cookies.min.js"&gt;&lt;/script&gt;
      &lt;!-- Backand SDK for Angular --&gt;
      &lt;script src="//cdn.backand.net/backand/dist/1.5.1/backand.min.js"&gt;&lt;/script&gt;
    </code></pre>
                <p>
                    You will also need to add the backand and angular-cookies dependencies to your angular app definition
                </p>
                <pre><code class="javascript">
      //app.js
      angular.module('YOUR-APP-NAME', ['backand', 'ngCookies'])
    </code></pre>
                <p>Now you are ready to sign in to Backand, for other users to sign up to your app read about it <a ng-href="\#/api#api-sign-up">here</a> There is also an option for anonymous access, read about it here</p>
                <br />
                <h4 id="sign_in">
                    Sign In
                </h4>
                <br />
                <p>Use the Backand provider with the following parameters to get an AOuth2 access token:</p>

                <ul class="task-list">
                    <li><p><strong>username</strong> - Backand's username.</p></li>
                    <li><p><strong>password</strong> - Backand's .password</p></li>
                    <li><p><strong>appName</strong> - The application name.</p></li>
                </ul>


                <pre><code>
      // SignInCtrl.js
      function SignInCtrl(Backand, $cookieStore) {
        $scope.signIn = function() {
          Backand.signin($scope.username, $scope.password, $scope.appName)
          .then(
            function (token) {
              //save the token in the cookie
              $cookieStore.put(Backand.configuration.tokenName, token);
            },
            function (data, status, headers, config) {
              //handle error
            }
          );
        }
      }

      // Use an Angular HTTP Interceptor to add the authentication token to each HTTP request
      function httpInterceptor($q, $log, $cookieStore) {
        return {
          request: function(config) {
            config.headers['Authorization'] = $cookieStore.get('backand_token');
            return config;
          }
        };
      }
    </code></pre>
                <br />
        <h4 id="api-sign-up">
            Sign Up
        </h4>
                <p>
                    With the <code>/user/signup</code> api you can enable other users to sign up to your app. 
                    The sign up process is consisted of the following steps:
                    <ul style="list-style-type:decimal">
                        <li>
                            From your app's registration page, call the
                            <code>/user/signup</code> action
                        </li>
                        <li>
                            This will automatically send an invitation email to the user for verification purposes
                        </li>
                        <li>
                            The email has a link that when the user clicks on it, Backand verifies his email address and complete the sign up process by redirecting to a page that you defined for this process, usually your app sign in page.
                        </li>
                    </ul>
                    The sign up api uses a SignUpToken in the request header. You can find this token in the Security & Auth Configuration menu
                    <br />
                    (*) Configuration of the sign up process is located in the App left side menu: Security & Auth --> Configuration
                </p>
        <br />
        <ul class="task-list">
            <li><p><strong>SignUpToken</strong> - A security token to prevent malicious attacks. this should be added to the header</p></li>
            <li><p><strong>user</strong> - The user first and last name, email and password.</p></li>
        </ul>
                <pre>
{
  "firstName": "string",
  "lastName": "string",
  "email": "string",
  "password": "string",
  "confirmPassword": "string"
}
</pre>

<pre>
  self.signUp = function (user, signUpToken) {
      return $http({
          method: 'POST',
          url : Backand.configuration.apiUrl + '/1/user/signup,
          headers: {
            'SignUpToken': signUpToken
          },
          data: user
      })
  };
</pre>
        

                <h4 id="anonymous_access">
                    Anonymous Access
                </h4>
                <p>
                    If you want to allow anonymous users to access the application, without username and password, you can use the AnonymousToken
                </p>
                <pre><code>
      
      // Use an Angular HTTP Interceptor to add the anonymous token to each HTTP request
      function httpInterceptor($q, $log) {
        return {
          request: function(config) {
            config.headers['AnonymousToken'] = anonymousToken;
            return config;
          }
        };
      }
    </code></pre>
                <br />

        <h3>
            REST API CRUD Operations
        </h3>
            <p>With the authentication configurations settled you can perform all the CRUD operations:</p>
            <br/>
            <h4>
                List of Objects
            </h4>
            <br/>
            <p>Call <code>/objects/{name}</code> with the following parameters to get a list of items:</p>

            <ul class="task-list">
                <li><p><strong>pageSize</strong> - The number of returned items in each getList call, default 20.</p></li>
                <li><p><strong>pageNumber</strong> - The page number starting with 1, default 1.</p></li>
                <li><p><strong>filter</strong> - An array where each item has the properties fieldName, operator and value. The operator options depend on the field type.</p></li>
                <li><p><strong>sort</strong> - An array where each item has the properties fieldName and order. The order options are "asc" or "desc".</p></li>
                <li><p><strong>search</strong> - Free text filter search.</p></li>
                <li><p><strong>deep</strong> - When set to true, brings the related parent items in the relatedTables property.</p></li>
                <!--<li><p></p><strong>withSelectOptions</strong> - When set to true, get a text value collection to load select options according to parent relations.</li>-->
            </ul>


<pre>
  self.getList = function (name, pageSize, pageNumber, filter, sort) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/objects/' + name,
          params: {
            pageSize: pageSize,
            pageNumber: pageNumber,
            sort: sort,
            filter: filter
          }
      });
  };
</pre>
            <br/>
            <h4>
                One Object
            </h4>
            <br/>
            <p>Call <code>/objects/{name}/{id}</code> with a specific item id and with the following parameters to get a specific item:</p>

            <ul class="task-list">
                <li><p><strong>id</strong> - The item id which is the primary kay value of a table row </p></li>
                <li><p><strong>deep</strong> - When set to true, brings the related objects</p></li>
            </ul>

<pre>
  self.getOne = function (name, id, deep) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/objects/' + name + '/' + id
          params: {
            deep: deep
          }
      });
  };
</pre>
            <br/>
            <h4>
                Create
            </h4>
            <br/>
            <p>Call <code>/objects/{name}</code> POST with a new object to create, with the following parameters:</p>

            <ul class="task-list">
                <li>
                    <strong>returnObject</strong> - Set this to true when you have server side business rules that causes additional changes to the object. In that case this request will return the created object
                </li>
            </ul>

<pre>
  self.create = function (name, data, returnObject) {
      return $http({
          method: 'POST',
          url : Backand.configuration.apiUrl + '/1/objects/' + name,
          data: data,
          params: {
            returnObject: returnObject
          }
      })
  };
</pre>
            <br/>
            <h4>
                Update
            </h4>
            <br/>
            <p>Call <code>/objects/{name}/{id}</code> PUT to update an existing object with the following parameters:</p>

            <ul class="task-list">
                <li>
                    <strong>id</strong> - The item id which is the primary kay value of a table row
                    <strong>returnObject</strong> - Set this to true when you have server side business rules, causing additional changes to the object. In this case the request will return the created object
                </li>
            </ul>

<pre>
  self.update = function (name, id, data, returnObject) {
      return $http({
          method: 'PUT',
          url : Backand.configuration.apiUrl + '/1/objects/' + name + '/' + id,
          data: data,
          params: {
            returnObject: returnObject
          }
      })
  };
</pre>
            <br/>
            <h4>
                Delete
            </h4>
            <br/>
            <p>Call <code>/objects/{name}/{id}</code> DELETE to remove an item:</p>
              <ul class="task-list">
                <li>
                  <strong>id</strong> - The item id which is the primary kay value of a table row
                </li>
              </ul>
<pre>
  self.delete = function (name, id) {
      return $http({
          method: 'DELETE',
          url : Backand.configuration.apiUrl + '/1/objects/' + name + '/' + id
      })
  };
</pre>
        <h3>
            Custom Actions
        </h3>
        <p>
            You can add your own custom actions and call them like this <code>/objects/action/{objectName}/{id}</code> The custom action is associated with an object list, to ease security configuration. 
            It can also be associated with a specific id of an object to be used as an input to the action but it is optional. You can also define additional parameters to the action. The action return a custom json.
        </p>
        <ul class="task-list">
            <li><p><strong>actionName</strong> - The action name.</p></li>
            <li><p><strong>parameters</strong> - json object with all predefined action's parameters.</p></li>
        </ul>
                <pre>
self.callAction = function (objectName, id, actionName, parameters) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/objects/action/' + objectName + '/' + id
          params: {
             parameters: parameters
          }
      });
  };
</pre>
                (*) You can find the configuration and testing environment of the custom actions in the App right side menu: each Object's Actions tab
                <br />
            <h3>
                Queries
            </h3>
                <p>
                    You can create your own queries and call them like this <code>/query/data/{queryName}</code> You write the query in the SQL syntex of the database you are using.
                    You can create predefine parameters and use them in the query
                </p>
                <ul class="task-list">
                    <li><p><strong>parameters</strong> - json object with all predefined query's parameters.</p></li>
                </ul>
                <pre>
self.query = function (queryName, parameters) {
      return $http({
          method: 'GET',
          url: Backand.configuration.apiUrl + '/1/query/data/' + queryName
          params: {
             parameters: parameters
          }
      });
  };
</pre>
                (*) You can find the configuration and testing environment of the queries in the App right side menu: Queries

                <br />
          <h3>Experience more</h3>
          <p>Review on <a href="https://github.com/backand/angular-yeoman-todos" target="_blank">github</a> our Angular demo application</p>
            </div>
        </div>
</div>
</section>
